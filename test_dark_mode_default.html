<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark Mode Default Test</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-container {
            background: var(--bg-container);
            border: 1px solid var(--border-container);
            border-radius: 8px;
            padding: 30px;
            margin: 20px 0;
        }
        .status {
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            background: var(--bg-theme-button);
            color: var(--text-theme-button);
            border: 1px solid var(--border-theme-button);
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 16px;
        }
        button:hover {
            background: var(--bg-theme-button-hover);
        }
        .theme-info {
            background: var(--bg-modal);
            border: 1px solid var(--border-modal);
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .logo-test {
            margin: 20px 0;
            text-align: center;
        }
        .code {
            background: var(--bg-container);
            border: 1px solid var(--border-container);
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üåô Dark Mode Default Test</h1>
        
        <div class="status info">
            <strong>Test Purpose:</strong> Verify that the application now defaults to dark mode for new users (no saved theme preference).
        </div>
        
        <div class="theme-info">
            <h3>Current Theme Status:</h3>
            <div id="current-theme-info"></div>
            <div id="logo-display" class="logo-test">
                <img id="cmrpLogo" src="Logo/CMRP Logo Light.svg" alt="CMRP Logo" style="height:60px;width:auto;">
                <p>Logo should be <strong>Light</strong> in dark mode, <strong>Dark</strong> in light mode</p>
            </div>
        </div>
        
        <h3>Test Actions:</h3>
        <button onclick="clearLocalStorage()">Clear localStorage (Test Fresh User)</button>
        <button onclick="toggleTheme()">Toggle Theme</button>
        <button onclick="checkThemeStatus()">Check Theme Status</button>
        <button onclick="testAllPages()">Test All Main Pages</button>
        
        <div id="test-results"></div>
        
        <div class="theme-info">
            <h3>Expected Behavior:</h3>
            <ul>
                <li>‚úÖ <strong>Fresh user (no localStorage):</strong> Should default to dark mode</li>
                <li>‚úÖ <strong>Saved preference:</strong> Should respect user's saved theme choice</li>
                <li>‚úÖ <strong>Logo:</strong> Should display correct logo for current theme</li>
                <li>‚úÖ <strong>Consistent across pages:</strong> All dashboard pages should use dark default</li>
            </ul>
        </div>
        
        <div class="code">
            <strong>Files Updated:</strong><br>
            ‚Ä¢ app.js - initializeTheme() function<br>
            ‚Ä¢ executive_dashboard.js - DOMContentLoaded event<br>
            ‚Ä¢ win-loss_dashboard.js - theme initialization<br>
            ‚Ä¢ forecastr_dashboard.js - DOMContentLoaded event<br>
            ‚Ä¢ user_management.html - applyThemeFromStorage() function
        </div>
    </div>

    <script>
        // Test implementation of dark mode default logic
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme');
            const theme = savedTheme || 'dark'; // Default to dark
            if (savedTheme === null) {
                localStorage.setItem('theme', 'dark');
            }
            
            document.documentElement.classList.toggle('dark', theme === 'dark');
            const logo = document.getElementById('cmrpLogo');
            if (logo) {
                logo.src = theme === 'dark' ? 'Logo/CMRP Logo Light.svg' : 'Logo/CMRP Logo Dark.svg';
            }
            
            return theme;
        }
        
        function addResult(message, type = 'info') {
            const results = document.getElementById('test-results');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }
        
        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
        }
        
        function clearLocalStorage() {
            clearResults();
            localStorage.removeItem('theme');
            addResult('‚úÖ localStorage theme cleared. Page will reload to test fresh user experience.', 'success');
            setTimeout(() => {
                window.location.reload();
            }, 1500);
        }
        
        function toggleTheme() {
            const currentTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.classList.toggle('dark', newTheme === 'dark');
            localStorage.setItem('theme', newTheme);
            
            const logo = document.getElementById('cmrpLogo');
            if (logo) {
                logo.src = newTheme === 'dark' ? 'Logo/CMRP Logo Light.svg' : 'Logo/CMRP Logo Dark.svg';
            }
            
            checkThemeStatus();
        }
        
        function checkThemeStatus() {
            clearResults();
            const savedTheme = localStorage.getItem('theme');
            const currentTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
            const hasStoredTheme = savedTheme !== null;
            
            document.getElementById('current-theme-info').innerHTML = `
                <strong>Current Theme:</strong> ${currentTheme}<br>
                <strong>Stored in localStorage:</strong> ${savedTheme || 'None'}<br>
                <strong>Has Saved Preference:</strong> ${hasStoredTheme ? 'Yes' : 'No (will default to dark)'}
            `;
            
            if (!hasStoredTheme && currentTheme === 'dark') {
                addResult('‚úÖ SUCCESS: Fresh user correctly defaults to dark mode!', 'success');
            } else if (!hasStoredTheme && currentTheme === 'light') {
                addResult('‚ùå ISSUE: Fresh user is defaulting to light mode instead of dark!', 'error');
            } else if (hasStoredTheme) {
                addResult(`‚ÑπÔ∏è User has saved preference: ${savedTheme}`, 'info');
            }
        }
        
        function testAllPages() {
            clearResults();
            addResult('üîÑ Testing theme consistency across all main pages...', 'info');
            
            const pages = [
                { name: 'Main App', url: 'index.html' },
                { name: 'Executive Dashboard', url: 'executive_dashboard.html' },
                { name: 'Win-Loss Dashboard', url: 'win-loss_dashboard.html' },
                { name: 'Forecast Dashboard', url: 'forecastr_dashboard.html' },
                { name: 'User Management', url: 'user_management.html' }
            ];
            
            addResult('üìã <strong>Pages to manually test:</strong>', 'info');
            pages.forEach(page => {
                addResult(`‚Ä¢ <a href="${page.url}" target="_blank">${page.name}</a> - Should default to dark mode`, 'info');
            });
            
            addResult('üí° <strong>Test Steps:</strong><br>1. Clear localStorage on this page<br>2. Open each page above in new tab<br>3. Verify dark mode is applied by default', 'info');
        }
        
        // Initialize theme on page load
        document.addEventListener('DOMContentLoaded', () => {
            const appliedTheme = initializeTheme();
            checkThemeStatus();
            
            // Show initial status
            setTimeout(() => {
                const hasStoredTheme = localStorage.getItem('theme') !== null;
                if (!hasStoredTheme) {
                    addResult('üÜï Fresh user detected - testing dark mode default', 'info');
                }
            }, 500);
        });
    </script>
</body>
</html>
