<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net https://cdn.tailwindcss.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data:; connect-src 'self';">
    <title>CMRP Win/Loss Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        /* --- Theme Variables --- */
        :root {
            /* Light Theme Variables */
            --bg-body: #f9fafb; --text-body: #1f2937; --bg-container: #ffffff; --border-container: #e5e7eb; --text-title: #111827; --text-label: #4b5563; --border-table: #e5e7eb; --bg-header: #f3f4f6; --text-header: #6b7280; --bg-row: #ffffff; --text-row: #374151; --bg-row-hover: #f3f4f6; --bg-op100: #dcfce7; --text-op100: #166534; --bg-op100-hover: #bbf7d0; --bg-lost: #fee2e2; --text-lost: #991b1b; --bg-lost-hover: #fecaca; --bg-declined: #e5e7eb; --text-declined: #4b5563; --bg-declined-hover: #d1d5db; --border-urgent-soon: #f59e0b; --border-urgent-past: #ef4444; --bg-control: #ffffff; --border-control: #d1d5db; --text-control: #111827; --placeholder-control: #9ca3af; --bg-control-hover: #f9fafb; --border-focus: #3b82f6; --shadow-focus: rgba(59, 130, 246, 0.3); --text-secondary: #6b7280; --text-error: #dc2626; --text-link: #3b82f6; --text-link-hover: #2563eb;
            --select-arrow-url: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            --bg-modal: #ffffff; --border-modal: #e5e7eb; --text-modal-title: #111827; --bg-modal-close-hover: #e5e7eb; --bg-modal-save: #3b82f6; --text-modal-save: #ffffff; --bg-modal-save-hover: #2563eb; --bg-theme-button: #e5e7eb; --text-theme-button: #1f2937; --border-theme-button: #d1d5db; --bg-theme-button-hover: #d1d5db; --bg-filter-button: #e5e7eb; --text-filter-button: #374151; --border-filter-button: #d1d5db; --bg-filter-button-hover: #d1d5db; --bg-filter-button-active: #4f46e5; --text-filter-button-active: #ffffff; --border-filter-button-active: #4f46e5;
            /* Chart specific */
            --chart-grid-color: rgba(0, 0, 0, 0.1); --chart-tick-color: #666; --chart-title-color: #333; --chart-legend-color: #333; --chart-tooltip-bg: rgba(0, 0, 0, 0.8); --chart-tooltip-text: #fff;
            /* Colors for Win/Loss */
            --color-loss: #ef4444; --color-loss-bg: rgba(239, 68, 68, 0.7);
            --color-win: #10b981; --color-win-bg: rgba(16, 185, 129, 0.7);
            --color-win-cost: #3b82f6; --color-win-cost-bg: rgba(59, 130, 246, 0.7);
            --color-loss-cost: #f97316; --color-loss-cost-bg: rgba(249, 115, 22, 0.7);
        }
        .dark {
            /* Dark Theme Variables */
             --bg-body: #1e1e1e; --text-body: #e0e0e0; --bg-container: #2d2d2d; --border-container: #404040; --text-title: #ffffff; --text-label: #c0c0c0; --border-table: #4a4a4a; --bg-header: #1a1a1a; --text-header: #a0a0a0; --bg-row: #2d2d2d; --text-row: #e0e0e0; --bg-row-hover: #3c3c3c; --bg-op100: #14532d; --text-op100: #dcfce7; --bg-op100-hover: #166534; --bg-lost: #7f1d1d; --text-lost: #fee2e2; --bg-lost-hover: #991b1b; --bg-declined: #4b5563; --text-declined: #bdc3c7; --bg-declined-hover: #525f70; --border-urgent-soon: #f97316; --border-urgent-past: #dc2626; --bg-control: #3c3c3c; --border-control: #5a5a5a; --text-control: #e0e0e0; --placeholder-control: #8e8e93; --bg-control-hover: #4a4a4a; --border-focus: #0a84ff; --shadow-focus: rgba(10, 132, 255, 0.3); --text-secondary: #a0a0a0; --text-error: #ff8080; --text-link: #8ab4f8; --text-link-hover: #a7c7fa;
             --select-arrow-url: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23a0a0a0' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
             --bg-modal: #2d2d2d; --border-modal: #404040; --text-modal-title: #ffffff; --bg-modal-close-hover: #6b6b6b; --bg-modal-save: #4f46e5; --text-modal-save: #ffffff; --bg-modal-save-hover: #4338ca; --bg-theme-button: #4b5563; --text-theme-button: #f9fafb; --border-theme-button: #6b7280; --bg-theme-button-hover: #6b7280; --bg-filter-button: #374151; --text-filter-button: #d1d5db; --border-filter-button: #4b5563; --bg-filter-button-hover: #4b5563; --bg-filter-button-active: #6366f1; --text-filter-button-active: #ffffff; --border-filter-button-active: #6366f1;
             /* Chart specific */
            --chart-grid-color: rgba(255, 255, 255, 0.2); --chart-tick-color: #9ca3af; --chart-title-color: #f9fafb; --chart-legend-color: #f9fafb; --chart-tooltip-bg: rgba(255, 255, 255, 0.9); --chart-tooltip-text: #1f2937;
             /* Colors for Win/Loss */
            --color-loss: #f87171; --color-loss-bg: rgba(248, 113, 113, 0.7);
            --color-win: #34d399; --color-win-bg: rgba(52, 211, 153, 0.7);
            --color-win-cost: #8ab4f8; --color-win-cost-bg: rgba(138, 180, 248, 0.7);
             --color-loss-cost: #fdba74; --color-loss-cost-bg: rgba(253, 186, 116, 0.7);
        }

        /* Base Styles */
        body { background-color: var(--bg-body); color: var(--text-body); transition: background-color 0.3s, color 0.3s; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; }
        .main-container { background-color: var(--bg-container); border-color: var(--border-container); }
        h1, h3 { color: var(--text-title); }
        .dashboard-card { background-color: var(--bg-container); border: 1px solid var(--border-container); border-radius: 0.5rem; padding: 1rem 1.5rem; text-align: center; box-shadow: 0 1px 3px 0 rgba(0,0,0,0.1), 0 1px 2px 0 rgba(0,0,0,0.06); flex: 1; min-width: 150px; }
        .dashboard-title { color: var(--text-secondary); font-size: 0.75rem; margin-bottom: 0.25rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .dashboard-value { color: var(--text-title); font-size: 1.875rem; font-weight: 600; line-height: 1.3; }
        .chart-section-container { background-color: var(--bg-container); border-radius: 0.5rem; box-shadow: 0 1px 3px 0 rgba(0,0,0,0.1), 0 1px 2px 0 rgba(0,0,0,0.06); }
        /* Form Controls (for filter dropdown) */
        select.filter-dropdown { appearance: none; background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; padding-right: 2.5rem; min-width: 150px; background-image: var(--select-arrow-url); background-color: var(--bg-control); border-color: var(--border-control); color: var(--text-control); border-width: 1px; }
        select.filter-dropdown:focus { outline: none; border-color: var(--border-focus); box-shadow: 0 0 0 3px var(--shadow-focus); }
        select.filter-dropdown option { background-color: var(--bg-control); color: var(--text-control); }
        /* Ensure buttons use theme colors */
        .theme-button { background-color: var(--bg-theme-button); color: var(--text-theme-button); border: 1.5px solid var(--border-theme-button); transition: background 0.18s, color 0.18s, border-color 0.18s, box-shadow 0.18s; box-shadow: 0 2px 8px 0 rgba(59,130,246,0.06); }
        .theme-button:hover, .theme-button:focus { background-color: var(--bg-theme-button-hover); box-shadow: 0 4px 16px 0 rgba(59,130,246,0.10); }
        .link-button { background-color: var (--bg-modal-save); color: var (--text-modal-save); transition: filter 0.2s; }
        .link-button:hover { filter: brightness(90%); }
         /* Explicit height for chart wrapper */
         .chart-wrapper { position: relative; height: 400px; width: 100%; }
        .dashboard-table th.project-name-cell, .dashboard-table td.project-name-cell {
            max-width: 300px;
            min-width: 120px;
            white-space: normal;
            word-break: break-word;
            text-align: left;
        }
        .dashboard-table th, .dashboard-table td {
            /* Use theme variables for consistency */
            background-color: var(--bg-row);
            color: var(--text-row);
            border-bottom: 1px solid var(--border-table);
        }
        .dashboard-table th {
            background-color: var(--bg-header);
            color: var(--text-header);
        }
        .dashboard-table tr:hover td {
            background-color: var(--bg-row-hover);
        }
        .filter-button.table-status-btn {
            border: 1px solid var(--border-table);
            background-color: var(--bg-filter-button);
            color: var (--text-filter-button);
            transition: background-color 0.2s, color 0.2s, border-color 0.2s;
        }
        .filter-button.table-status-btn.active {
            background-color: var(--bg-filter-button-active);
            color: var(--text-filter-button-active);
            border-color: var(--border-filter-button-active);
            font-weight: 600;
        }
        .filter-button.table-status-btn:hover {
            background-color: var(--bg-filter-button-hover);
        }
        .simple-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            width: 100%;
            z-index: 100;
            box-shadow: 0 2px 8px 0 rgba(0,0,0,0.08);
            background: var(--bg-header);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            min-height: 3.5rem;
            gap: 1.5rem;
        }
        .main-content {
            margin-top: 4.5rem;
        }
        .nav-square-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            border-radius: 0.75rem;
            background: var(--bg-theme-button);
            color: var(--text-theme-button);
            border: 1.5px solid var(--border-theme-button);
            font-size: 1.6rem;
            transition: background 0.18s, color 0.18s, border-color 0.18s, box-shadow 0.18s;
            box-shadow: 0 2px 8px 0 rgba(59,130,246,0.06);
            margin: 0;
            padding: 0;
        }
        .nav-square-btn:hover, .nav-square-btn:focus {
            background: var(--bg-theme-button-hover);
            color: var(--text-theme-button);
            box-shadow: 0 4px 16px 0 rgba(59,130,246,0.10);
            outline: none;
        }
        .nav-square-btn.active, .nav-square-btn.bg-blue-600 {
            background: #6366f1;
            color: #fff !important;
            border-color: #6366f1;
            cursor: default;
            pointer-events: none;
        }
        .nav-square-btn .material-icons {
            font-size: 1.7rem;
        }
        .dark .nav-square-btn.active {
            background: #6366f1;
            color: #fff !important;
            border-color: #6366f1;
        }
        .dark .nav-square-btn:hover:not(.active) {
            background: #6b7280;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="simple-header">
        <div class="title-group">
            <img id="cmrpLogo" src="Logo/CMRP Logo Light.svg" alt="CMRP Logo" style="height:2.2rem;width:auto;display:inline-block;vertical-align:middle;transition:filter 0.2s;" />
            <span class="subtitle">Win-Loss Dashboard</span>
        </div>
        <div class="flex items-center gap-2">
            <nav class="flex gap-2" id="mainNav">
                <a href="index.html" class="nav-square-btn" title="Opportunities"><span class="material-icons">dashboard</span></a>
                <a href="win-loss_dashboard.html" class="nav-square-btn active" title="Win-Loss Dashboard"><span class="material-icons">line_axis</span></a>
                <a href="forecastr_dashboard.html" class="nav-square-btn" title="Forecast Dashboard"><span class="material-icons">insights</span></a>
                <a href="user_management.html" class="nav-square-btn" id="userMgmtNavBtn" title="User Management" style="display:none;"><span class="material-icons">group</span></a>
            </nav>
            <button id="themeToggle" class="nav-square-btn" title="Toggle Theme"><span class="material-icons">light_mode</span></button>
            <button id="logoutBtn" class="nav-square-btn" title="Logout"><span class="material-icons">logout</span></button>
        </div>
    </div>
    <div class="main-content">
        <div class="main-container container mx-auto p-6 rounded-lg shadow-md">
            <div class="flex flex-wrap gap-4 items-center mb-6" id="filterBar">
                <div>
                    <label for="solutionFilter" class="text-sm font-medium mr-1">Solution:</label>
                    <select id="solutionFilter" class="filter-dropdown p-1 text-xs rounded border">
                        <option value="all">All Solutions</option>
                    </select>
                </div>
                <div>
                    <label for="accountMgrFilter" class="text-sm font-medium mr-1">Account Mgr:</label>
                    <select id="accountMgrFilter" class="filter-dropdown p-1 text-xs rounded border">
                        <option value="all">All</option>
                    </select>
                </div>
                <div>
                    <label for="clientFilter" class="text-sm font-medium mr-1">Client:</label>
                    <select id="clientFilter" class="filter-dropdown p-1 text-xs rounded border">
                        <option value="all">All</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="dashboard-card">
                    <div id="op100-total-count-title" class="dashboard-title">Total OP100 Count</div>
                    <div id="op100-total-count" class="dashboard-value">0</div>
                </div>
                <div class="dashboard-card">
                     <div id="op100-total-amount-title" class="dashboard-title">Total OP100 Amount</div>
                    <div id="op100-total-amount" class="dashboard-value">₱0</div>
                </div>
                 <div class="dashboard-card">
                    <div id="loss-total-count-title" class="dashboard-title">Total Lost Opportunity Count</div>
                    <div id="loss-total-count" class="dashboard-value">0</div>
                </div>
                <div class="dashboard-card">
                     <div id="loss-total-amount-title" class="dashboard-title">Total Lost Opportunity Amount</div>
                    <div id="loss-total-amount" class="dashboard-value">₱0</div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <div class="chart-section-container p-6">
                    <h3 class="text-lg font-semibold mb-4">Monthly Wins (OP100)</h3>
                    <div class="chart-wrapper">
                        <canvas id="winMonthlyChart"></canvas>
                    </div>
                </div>
                <div class="chart-section-container p-6">
                    <h3 class="text-lg font-semibold mb-4">Monthly Lost Opportunities</h3>
                    <div class="chart-wrapper">
                        <canvas id="lossMonthlyChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Opportunities Table Section -->
            <div class="mt-10">
                <h3 class="text-lg font-semibold mb-4">Opportunities List</h3>
                <div class="flex flex-wrap gap-2 mb-2">
                    <button id="filterOP100Btn" class="filter-button table-status-btn px-3 py-1 rounded text-xs">OP100</button>
                    <button id="filterLOSTBtn" class="filter-button table-status-btn px-3 py-1 rounded text-xs">LOST</button>
                    <button id="filterAllBtn" class="filter-button table-status-btn px-3 py-1 rounded text-xs active">All</button>
                </div>
                <div class="overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700">
                    <table id="opportunitiesTable" class="min-w-full divide-y divide-gray-200 dark:divide-gray-700 dashboard-table">
                        <thead class="bg-gray-100 dark:bg-gray-800">
                            <tr>
                                <th class="project-name-cell px-4 py-2 text-left text-xs font-semibold">Project Name</th>
                                <th class="px-4 py-2 text-left text-xs font-semibold">Client</th>
                                <th class="px-4 py-2 text-left text-xs font-semibold">Account Mgr</th>
                                <th class="px-4 py-2 text-left text-xs font-semibold">Date Awarded</th>
                                <th class="px-4 py-2 text-right text-xs font-semibold">Final Amt</th>
                                <th class="px-4 py-2 text-right text-xs font-semibold">Margin</th>
                            </tr>
                        </thead>
                        <tbody id="opportunitiesTableBody" class="bg-white dark:bg-gray-900">
                            <!-- Rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            </div>

        <!-- Authentication Modal (Unified) -->
        <div id="authModalOverlay" style="display:none;position:fixed;z-index:1000;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.25);backdrop-filter:blur(1.5px);">
            <div id="authModal" style="display:none;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--bg-modal,#fff);border:1.5px solid var(--border-modal,#e5e7eb);border-radius:1rem;box-shadow:0 8px 32px 0 rgba(31,38,135,0.15);padding:2.5rem 2.2rem;min-width:320px;max-width:95vw;">
                <h2 id="authModalTitle" style="font-size:1.3rem;font-weight:600;margin-bottom:1.2rem;color:var(--text-modal-title,#111827);">Login</h2>
                <form id="authForm" autocomplete="off">
                    <div style="margin-bottom:1rem;">
                        <label for="authEmail" style="display:block;font-size:0.95rem;font-weight:500;margin-bottom:0.2rem;">Email</label>
                        <input id="authEmail" name="email" type="email" required style="width:100%;padding:0.5rem;border-radius:0.4rem;border:1px solid #d1d5db;">
                    </div>
                    <div style="margin-bottom:1rem;">
                        <label for="authPassword" style="display:block;font-size:0.95rem;font-weight:500;margin-bottom:0.2rem;">Password</label>
                        <input id="authPassword" name="password" type="password" required minlength="8" style="width:100%;padding:0.5rem;border-radius:0.4rem;border:1px solid #d1d5db;">
                    </div>
                    <div id="registerFields" style="display:none;">
                        <div style="margin-bottom:1rem;">
                            <label for="authName" style="display:block;font-size:0.95rem;font-weight:500;margin-bottom:0.2rem;">Name</label>
                            <input id="authName" name="name" type="text" minlength="2" maxlength="100" style="width:100%;padding:0.5rem;border-radius:0.4rem;border:1px solid #d1d5db;">
                        </div>
                        <div style="margin-bottom:1rem;">
                            <label style="display:block;font-size:0.95rem;font-weight:500;margin-bottom:0.2rem;">Role(s)</label>
                            <label style="margin-right:1rem;"><input type="checkbox" name="role" value="admin"> Admin</label>
                            <label style="margin-right:1rem;"><input type="checkbox" name="role" value="manager"> Manager</label>
                            <label><input type="checkbox" name="role" value="user"> User</label>
                        </div>
                    </div>
                    <div id="authError" style="display:none;color:#dc2626;font-size:0.97rem;margin-bottom:0.7rem;"></div>
                    <div id="authSuccess" style="display:none;color:#16a34a;font-size:0.97rem;margin-bottom:0.7rem;"></div>
                    <button id="authSubmitBtn" type="submit" style="width:100%;background:var(--bg-modal-save,#3b82f6);color:var(--text-modal-save,#fff);padding:0.6rem 0;font-size:1.08rem;font-weight:600;border:none;border-radius:0.4rem;cursor:pointer;transition:background 0.18s;">Login</button>
                </form>
                <div style="margin-top:1.1rem;text-align:center;">
                    <button id="switchAuthMode" type="button" style="background:none;border:none;color:var(--text-link,#3b82f6);font-size:0.98rem;cursor:pointer;text-decoration:underline;">Don't have an account? Register</button>
                </div>
            </div>
        </div>
        <!-- End Authentication Modal -->
        
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="win-loss_dashboard.js"></script>
    </body>
</html>
